<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AURA Perfumes | Premium Fragrances Baybay City</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="logo.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --gold: #C5A059; --dark: #1A1A1A; --light: #FAFAFA; }
        body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: var(--light); color: #333; scroll-behavior: smooth; overflow-x: hidden; }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        .fade-in { opacity: 0; transform: translateY(30px); transition: opacity 0.8s ease-out, transform 0.8s ease-out; }
        .fade-in.visible { opacity: 1; transform: translateY(0); }

        /* NAVIGATION FIX FOR MOBILE */
        nav { background-color: rgba(26, 26, 26, 0.95); color: #E8DCC4; display: flex; justify-content: space-between; align-items: center; padding: 15px 40px; position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); border-bottom: 1px solid rgba(197, 160, 89, 0.2); }
        .logo { font-size: 1.8em; font-weight: bold; letter-spacing: 3px; }
        .nav-links a { color: #E8DCC4; text-decoration: none; margin: 0 10px; font-size: 0.85em; transition: color 0.3s; text-transform: uppercase; white-space: nowrap; }
        
        @media (max-width: 600px) {
            nav { flex-direction: column; padding: 15px; gap: 12px; }
            .nav-links { display: flex; gap: 15px; justify-content: center; }
            .nav-links a { margin: 0; font-size: 0.8em; }
            .hero h1 { font-size: 3.2em; }
        }

        .hero { background: linear-gradient(135deg, #111 0%, #2a2a2a 100%); color: #E8DCC4; text-align: center; padding: 80px 20px; border-bottom: 4px solid var(--gold); }
        .hero h1 { letter-spacing: 6px; margin: 0; font-size: 4em; }

        section { padding: 60px 30px; margin: 50px auto; max-width: 900px; background: white; border-radius: 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.04); }
        h2 { text-align: center; color: var(--dark); margin-bottom: 40px; font-size: 2.5em; position: relative; }
        h2::after { content: ''; display: block; width: 60px; height: 3px; background: var(--gold); margin: 15px auto 0; }

        .shop-container { display: flex; gap: 40px; justify-content: center; flex-wrap: wrap; }
        .product { position: relative; display: flex; flex-direction: column; padding: 25px; text-align: center; width: 280px; border-radius: 20px; background: #fff; box-shadow: 0 10px 30px rgba(0,0,0,0.05); transition: all 0.4s ease; border: 1px solid rgba(0,0,0,0.02); }
        .product:hover { transform: translateY(-10px); }

        .img-container { position: relative; width: 100%; height: 300px; border-radius: 15px; overflow: hidden; margin-bottom: 15px; background: #fcfcfc; }
        .img-container img { width: 100%; height: 100%; object-fit: contain; transition: transform 0.5s; display: block; }
        .product:hover .img-container img { transform: scale(1.05); }
        
        .notes-overlay { position: absolute; top: 100%; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; transition: top 0.4s ease; border-top: 3px solid var(--gold); }
        .product:hover .notes-overlay { top: 0; }
        .notes-overlay h4 { margin: 0 0 15px; color: var(--gold); font-size: 1.1em; }
        .notes-overlay p { margin: 5px 0; font-size: 0.9em; text-align: center; color: #555; }

        .price { font-size: 1.4em; color: var(--dark); font-weight: 700; margin: 15px 0; }
        button { background: linear-gradient(135deg, #C5A059 0%, #A38040 100%); color: white; border: none; padding: 14px; cursor: pointer; border-radius: 30px; font-weight: 600; text-transform: uppercase; transition: 0.3s; width: 100%; }
        button:hover { opacity: 0.9; transform: scale(1.02); }

        /* MODALS & INPUTS */
        .modal { display: none; position: fixed; z-index: 2000; padding-top: 60px; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); }
        .modal-content { margin: auto; display: block; width: 85%; max-width: 400px; border-radius: 25px; background: white; padding: 35px; position: relative; max-height: 85vh; overflow-y: auto;}
        .close-btn { position: absolute; top: 15px; right: 25px; font-size: 32px; cursor: pointer; color: #aaa; }
        
        /* APP INSTALL IOS POPUP */
        #ios-install-modal { display: none; position: fixed; bottom: 0; left: 0; width: 100%; background: #fff; padding: 25px 20px; box-shadow: 0 -5px 25px rgba(0,0,0,0.15); z-index: 3000; text-align: center; border-radius: 25px 25px 0 0; box-sizing: border-box; }
        
        .receipt-box { background: #fdfaf4; padding: 15px; border-radius: 15px; border: 1px solid rgba(197,160,89,0.3); margin: 15px 0; display: none; }
        .receipt-box p { margin: 5px 0; font-size: 0.85em; display: flex; justify-content: space-between; align-items: center;}
        
        input, select, textarea { width: 100%; margin-bottom: 10px; padding: 12px; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

        .history-btn { position: fixed; bottom: 85px; right: 20px; background: white; color: var(--dark); border: 1px solid var(--gold); padding: 10px 20px; border-radius: 50px; cursor: pointer; z-index: 998; font-size: 0.8em; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: none; width: auto;}
        .chat-btn { position: fixed; bottom: 20px; right: 20px; background: #0084FF; color: white; padding: 15px 25px; border-radius: 50px; font-weight: bold; font-size: 1em; cursor: pointer; z-index: 999; box-shadow: 0 4px 20px rgba(0,132,255,0.4); text-decoration: none; display: flex; align-items: center; gap: 8px; transition: transform 0.3s; width: auto;}
        .chat-btn:hover { transform: scale(1.05); }

        .tracker-box { background: #fdfaf4; padding: 30px; border-radius: 20px; border: 2px dashed var(--gold); text-align: center; }
        #tracker-result { margin-top: 15px; display: none; }
        .order-card { background: #fff; padding: 15px; border-radius: 10px; border: 1px solid #eee; text-align: left; margin-bottom: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .star-input { display: flex; flex-direction: row-reverse; justify-content: center; font-size: 2.5em; cursor: pointer; }
        .star-input input { display: none; }
        .star-input label { color: #ccc; transition: 0.2s; }
        .star-input input:checked ~ label, .star-input label:hover, .star-input label:hover ~ label { color: #FFD700; }
        .verify-box { background: #fff; padding: 20px; border-radius: 15px; border: 1px solid #ddd; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>

    <nav>
        <div class="logo">AURA</div>
        <div class="nav-links">
            <a href="#shop">Shop</a>
            <a href="#track">Track Order</a>
            <a href="#reviews">Reviews</a>
        </div>
    </nav>

    <header class="hero">
        <h1 class="fade-in">AURA</h1>
        <p class="fade-in" style="margin-bottom: 30px;">Premium Fragrances | Baybay City Delivery</p>
        
        <button id="install-btn" class="fade-in" style="display: none; background: white; color: var(--dark); max-width: 220px; margin: 0 auto; box-shadow: 0 4px 15px rgba(0,0,0,0.3);">üì± Install AURA App</button>
    </header>

    <button class="history-btn" id="history-btn" onclick="useHistory()">‚ôªÔ∏è Autofill Info</button>
    <a href="https://www.facebook.com/jm.geromala" target="_blank" class="chat-btn">üí¨ Live Chat</a>

    <section id="shop">
        <h2>Our Collection</h2>
        <div class="shop-container">
            <div class="product fade-in">
                <div class="img-container">
                    <img src="golden-hour.jpg" alt="Golden Hour">
                    <div class="notes-overlay">
                        <h4>Scent Profile</h4>
                        <p><strong>Top:</strong> Bergamot, Citrus<br><strong>Heart:</strong> Jasmine<br><strong>Base:</strong> Wood, Musk</p>
                    </div>
                </div>
                <h3>Golden Hour</h3>
                <p class="product-desc">50ml | Inspired by Okada Manila.</p>
                <div class="price">‚Ç±175.00</div>
                <button onclick="openOrderForm('Golden Hour', 175)">Order Now</button>
            </div>

            <div class="product fade-in">
                <div class="img-container">
                    <img src="bamboo-zen.jpg" alt="Bamboo Zen">
                    <div class="notes-overlay">
                        <h4>Scent Profile</h4>
                        <p><strong>Top:</strong> Green Leaves<br><strong>Heart:</strong> Lush Bamboo<br><strong>Base:</strong> Light Musk</p>
                    </div>
                </div>
                <h3>Bamboo Zen</h3>
                <p class="product-desc">50ml | Inspired by Fresh Bamboo.</p>
                <div class="price">‚Ç±175.00</div>
                <button onclick="openOrderForm('Bamboo Zen', 175)">Order Now</button>
            </div>
        </div>

        <div class="fade-in" style="background:#fdfaf4; border:2px dashed var(--gold); padding:40px; text-align:center; border-radius:20px; margin-top:50px;">
            <h3 style="margin-top:0; font-size: 1.8em;">Duo Bundle Offer</h3>
            <p style="font-size: 1.1em;">Get 1 Golden Hour + 1 Bamboo Zen for only <strong>‚Ç±330.00</strong></p>
            <button onclick="openOrderForm('Duo Bundle', 330)" style="max-width:300px; padding: 16px;">Claim Bundle Deal</button>
        </div>
    </section>

    <section id="track">
        <h2>Track Your Order</h2>
        <div class="tracker-box fade-in">
            <p>Enter your 11-digit phone number to track your delivery.</p>
            <input type="tel" id="track-phone" placeholder="09..." maxlength="11" style="max-width: 300px; display: block; margin: 0 auto 15px auto;">
            <button onclick="checkOrderStatus()" style="max-width: 200px;">Check Status</button>
            <div id="tracker-result"></div>
        </div>
    </section>

    <div id="orderModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeOrderForm()">√ó</span>
            <div id="checkout-step-1">
                <h2 style="margin-top: 0;">Checkout</h2>
                <p id="order-item-name" style="color: var(--gold); font-weight: bold; margin-bottom: 5px;"></p>
                <input type="hidden" id="hidden-product"><input type="hidden" id="hidden-price">
                
                <input type="text" id="order-name" placeholder="Full Name">
                <input type="tel" id="order-phone" placeholder="Phone Number (e.g., 09123456789)" maxlength="11">
                <input type="text" id="order-fb" placeholder="Facebook Name or Link (Optional)">
                
                <button type="button" onclick="getLocation()" id="pin-location-btn" style="background:#eee;color:#333; border:1px solid #ddd; margin-bottom: 10px;">üìç Tap to Pin Location & Get Fee</button>
                <textarea id="order-address-fallback" placeholder="Manual address..." rows="2" style="display: none;"></textarea>
                
                <div class="receipt-box" id="receipt-display">
                    <p><span>Item Price:</span> <span id="display-price">‚Ç±0</span></p>
                    <div style="font-size: 0.8em; color: #666; margin: 10px 0; padding-bottom: 5px; border-bottom: 1px dashed #ccc;">
                        <strong>Delivery Fee Breakdown:</strong><br>
                        <span id="fee-breakdown">Pending Location...</span>
                    </div>
                    <p style="font-weight:bold; font-size:1.1em; margin-top:10px;"><span>Total (COD):</span> <span id="display-total">‚Ç±0</span></p>
                </div>
                <button id="confirm-order-btn" onclick="submitOrder()">Confirm Order</button>
            </div>
            
            <div id="checkout-step-2" style="display: none; text-align: center; padding: 30px 0;">
                <h2 style="color: #27ae60; font-size: 2.5em; margin-bottom: 10px;">‚úÖ</h2>
                <h2 style="color: #2A2A2A; margin-top: 0;">Order Confirmed!</h2>
                <p style="color: #666;">Your order has been saved successfully. We will prepare it right away.</p>
                <p style="font-size: 0.9em; font-weight: bold; margin-bottom: 20px;">You can track your status in the "Track Order" section!</p>
                <a href="https://www.facebook.com/jm.geromala" target="_blank" style="display: inline-block; background: #0084FF; color: white; padding: 12px 25px; border-radius: 30px; text-decoration: none; font-weight: bold; margin-bottom: 10px; width: 100%; box-sizing: border-box;">üí¨ Message Us on FB</a>
                <button onclick="closeOrderForm()" style="background: #2A2A2A;">Close</button>
            </div>
        </div>
    </div>

    <div id="ios-install-modal">
        <h3 style="margin-top:0; color: var(--dark);">Install AURA App</h3>
        <p style="font-size: 0.9em; color: #555;">To install this app on your iPhone:</p>
        <p style="font-size: 0.9em; text-align: left; background: #f9f9f9; padding: 15px; border-radius: 10px;">
            1. Tap the <strong>Share</strong> icon at the bottom of Safari.<br><br>
            2. Scroll down and tap <strong>Add to Home Screen</strong> <span style="font-size:1.2em;">+</span>.
        </p>
        <button onclick="document.getElementById('ios-install-modal').style.display='none'" style="margin-top:10px;">Got it!</button>
    </div>

    <section id="reviews">
        <h2>Customer Reviews</h2>
        <div id="reviews-list">Loading...</div>
        
        <div style="background:#f9f9f9; padding:20px; border-radius:15px; margin-top:30px;">
            <h3 style="text-align: center; margin-top:0;">Leave a Review</h3>
            <div id="review-verification-step" class="verify-box">
                <p style="font-size: 0.9em; color: #666; margin-top:0;">Only customers with a <strong>Delivered</strong> status can leave a review.</p>
                <input type="tel" id="review-verify-phone" placeholder="Enter Phone Number..." maxlength="11" style="max-width:250px; margin:0 auto 10px auto; display:block;">
                <button onclick="verifyReviewEligibility()" style="max-width:150px;">Verify</button>
            </div>

            <div id="rev-f" style="display:none; text-align:center;">
                <p style="color:#27ae60; font-weight:bold; font-size:0.9em;">‚úÖ Verified! Select the item you purchased:</p>
                <select id="rev-p" style="max-width:300px; margin: 0 auto 15px auto; display:block;"></select>
                <div class="star-input" style="margin-bottom: 15px;">
                    <input type="radio" id="s5" name="rating" value="5"><label for="s5">‚òÖ</label>
                    <input type="radio" id="s4" name="rating" value="4"><label for="s4">‚òÖ</label>
                    <input type="radio" id="s3" name="rating" value="3"><label for="s3">‚òÖ</label>
                    <input type="radio" id="s2" name="rating" value="2"><label for="s2">‚òÖ</label>
                    <input type="radio" id="s1" name="rating" value="1"><label for="s1">‚òÖ</label>
                </div>
                <input type="text" id="rev-n" placeholder="Your Name" style="max-width:300px; margin:0 auto 10px auto; display:block;">
                <textarea id="rev-c" placeholder="Write your review here..." rows="3" style="max-width:300px; margin:0 auto 15px auto; display:block;"></textarea>
                <button onclick="saveReview()" style="max-width:200px;">Submit Review</button>
            </div>
        </div>
    </section>

    <footer style="background:var(--dark); color:#E8DCC4; text-align:center; padding:40px 20px;">
        <p>¬© 2026 AURA Perfumes</p>
        <a href="https://www.facebook.com/jm.geromala" target="_blank" style="color: var(--gold); text-decoration: none; font-size: 0.9em;">Visit our Facebook</a>
    </footer>

    <script>
        const SHEET_URL = 'https://api.sheetbest.com/sheets/81917155-8fe3-4fec-8f35-d820c6cef33d';
        let userLocationLink = "", finalFee = 0;
        
        const MY_LAT = 10.677926; 
        const MY_LNG = 124.806623; 
        const FEE_PER_KM = 5;

        // PWA APP INSTALL LOGIC
        let deferredPrompt;
        const installBtn = document.getElementById('install-btn');
        const iosModal = document.getElementById('ios-install-modal');

        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isStandalone = window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;

        if (isIOS && !isStandalone) {
            installBtn.style.display = 'block';
            installBtn.onclick = () => { iosModal.style.display = 'block'; };
        }

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
            installBtn.addEventListener('click', () => {
                installBtn.style.display = 'none';
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => { deferredPrompt = null; });
            });
        });

        const obs = new IntersectionObserver((es) => es.forEach(e => { if(e.isIntersecting) e.target.classList.add('visible'); }), { threshold: 0.1 });
        document.querySelectorAll('.fade-in').forEach(el => obs.observe(el));

        function checkHistory() { if(localStorage.getItem('aura_name')) document.getElementById('history-btn').style.display = 'block'; }
        function useHistory() {
            document.getElementById('order-name').value = localStorage.getItem('aura_name') || "";
            document.getElementById('order-phone').value = localStorage.getItem('aura_phone') || "";
            document.getElementById('order-fb').value = localStorage.getItem('aura_fb') || "";
        }

        function openOrderForm(prod, price) {
            document.getElementById('hidden-product').value = prod; 
            document.getElementById('hidden-price').value = price;
            document.getElementById('order-item-name').innerText = "Ordering: " + prod; 
            document.getElementById('display-price').innerText = `‚Ç±${price}`;
            document.getElementById('fee-breakdown').innerText = "Pending Location...";
            
            document.getElementById('receipt-display').style.display = 'block'; 
            document.getElementById('checkout-step-1').style.display = 'block';
            document.getElementById('checkout-step-2').style.display = 'none'; 
            document.getElementById('orderModal').style.display = 'block';
            
            checkHistory(); updateTotal();
        }

        function closeOrderForm() { document.getElementById('orderModal').style.display = 'none'; }

        function updateTotal() {
            const price = parseInt(document.getElementById('hidden-price').value);
            document.getElementById('display-total').innerText = `‚Ç±${price + finalFee}`;
        }

        function getLocation() {
            const btn = document.getElementById("pin-location-btn"); btn.innerText = "Locating... ‚è≥";
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(p => {
                    const lat = p.coords.latitude, lng = p.coords.longitude;
                    
                    userLocationLink = `https://maps.google.com/?q=${lat},${lng}`;
                    
                    const R = 6371; const dLa = (lat-MY_LAT)*Math.PI/180; const dLo = (lng-MY_LNG)*Math.PI/180;
                    const a = Math.sin(dLa/2)**2 + Math.cos(MY_LAT*Math.PI/180)*Math.cos(lat*Math.PI/180)*Math.sin(dLo/2)**2;
                    const d = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
                    
                    if (d < 1) {
                        finalFee = 0;
                        document.getElementById('fee-breakdown').innerHTML = `<span style="color:#27ae60; font-weight:bold;">Under 1km: FREE Delivery!</span>`;
                    } else {
                        finalFee = Math.round(d * FEE_PER_KM);
                        document.getElementById('fee-breakdown').innerText = `Distance (${d.toFixed(1)}km √ó ‚Ç±${FEE_PER_KM}) = ‚Ç±${finalFee}`;
                    }
                    updateTotal();
                    btn.innerText = "‚úÖ Location Pinned!"; btn.style.background = "#e8f8f5"; btn.style.color = "#27ae60";
                }, () => { alert("Please turn on GPS"); document.getElementById('order-address-fallback').style.display = 'block'; });
            }
        }

        async function submitOrder() {
            const p = document.getElementById('hidden-product').value;
            const n = document.getElementById('order-name').value.trim();
            const ph = document.getElementById('order-phone').value.trim();
            const fb = document.getElementById('order-fb').value.trim();
            const ad = userLocationLink || document.getElementById('order-address-fallback').value;
            const total = parseInt(document.getElementById('hidden-price').value) + finalFee;
            const orderId = "AURA-" + Math.floor(Math.random() * 100000); 

            if(!n || !ph || !ad) return alert("Please fill in your Name, Phone, and Location.");
            if(ph.length !== 11 || !ph.startsWith("09")) return alert("‚ö†Ô∏è Please enter a valid 11-digit phone number (e.g., 09123456789).");

            const btn = document.getElementById('confirm-order-btn');
            btn.innerText = "Processing... ‚è≥"; btn.disabled = true;

            localStorage.setItem('aura_name', n); localStorage.setItem('aura_phone', ph); localStorage.setItem('aura_fb', fb);

            const data = { 
                type: "Order", name: n, phone: ph, address: fb ? `${ad} | FB: ${fb}` : ad, prod: p, 
                date: new Date().toLocaleDateString(), order_id: orderId, total_price: total, status: "Pending" 
            };
            
            try { 
                await fetch(SHEET_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(data) }); 
                document.getElementById('checkout-step-1').style.display = 'none';
                document.getElementById('checkout-step-2').style.display = 'block';
                btn.innerText = "Confirm Order"; btn.disabled = false;
            } catch(e){ alert("Error saving order."); btn.innerText = "Confirm Order"; btn.disabled = false; }
        }

        async function checkOrderStatus() {
            const phoneInput = document.getElementById('track-phone').value;
            const resultBox = document.getElementById('tracker-result');
            if(phoneInput.length !== 11) return alert("Please enter your 11-digit phone number.");
            
            resultBox.style.display = 'block'; resultBox.innerHTML = "Searching our system... ‚è≥";

            try {
                const res = await fetch(SHEET_URL); const data = await res.json();
                const searchPhone = phoneInput.toString().trim().replace(/^0+/, '');
                const userOrders = data.slice().reverse().filter(row => row.type === "Order" && row.phone && row.phone.toString().trim().replace(/^0+/, '') === searchPhone);
                
                if(userOrders.length > 0) {
                    let html = `<h3 style="margin-top:0; color:#C5A059;">Found ${userOrders.length} Order(s)</h3>`;
                    userOrders.forEach(order => {
                        let statusColor = order.status === "Delivered" ? "#27ae60" : "#C5A059";
                        html += `<div class="order-card"><span style="font-size:0.8em; color:#888;">Order ID: ${order.order_id}</span><br><strong>${order.prod}</strong><br>Status: <span style="color:${statusColor}; font-weight:bold;">${order.status || "Pending"}</span></div>`;
                    });
                    resultBox.innerHTML = html;
                } else { resultBox.innerHTML = "<span style='color: #e74c3c;'>‚ùå No orders found with this number.</span>"; }
            } catch(e) { resultBox.innerHTML = "Network error. Please try again."; }
        }

        async function verifyReviewEligibility() {
            const ph = document.getElementById('review-verify-phone').value.trim();
            if(ph.length !== 11) return alert("Please enter your valid 11-digit phone number.");
            
            const btn = event.target; btn.innerText = "Checking...";
            try {
                const res = await fetch(SHEET_URL); const data = await res.json();
                const searchPhone = ph.replace(/^0+/, '');
                const deliveredOrders = data.filter(row => row.type === "Order" && row.phone && row.phone.toString().trim().replace(/^0+/, '') === searchPhone && row.status === "Delivered");
                
                if(deliveredOrders.length > 0) {
                    const select = document.getElementById('rev-p'); select.innerHTML = '';
                    [...new Set(deliveredOrders.map(o => o.prod))].forEach(p => select.innerHTML += `<option>${p}</option>`);
                    document.getElementById('review-verification-step').style.display = 'none';
                    document.getElementById('rev-f').style.display = 'block';
                } else { alert("Sorry! You can only leave a review after your order has been successfully delivered."); btn.innerText = "Verify"; }
            } catch(e) { alert("Network Error"); btn.innerText = "Verify"; }
        }

        async function displayReviews() {
            try {
                const res = await fetch(SHEET_URL); const data = await res.json();
                const revs = data.filter(r => r.type === "Review").reverse();
                document.getElementById('reviews-list').innerHTML = revs.map(r => `<div style="padding:15px; border-bottom:1px solid #eee;"><strong>${r.name}</strong> <span style="font-size:0.75em; background:#e8f8f5; color:#27ae60; padding:2px 6px; border-radius:5px; margin-left:5px;">‚úì Verified Buyer</span><br><span style="color:#FFD700;">${"‚òÖ".repeat(r.stars)}</span> <span style="font-size:0.8em; color:#888;">(${r.prod})</span><p style="margin:5px 0; color:#555;">${r.content}</p></div>`).join('') || "No reviews yet.";
            } catch(e){}
        }

        async function saveReview() {
            const n = document.getElementById('rev-n').value.trim() || "Anonymous", c = document.getElementById('rev-c').value.trim(), s = document.querySelector('input[name="rating"]:checked');
            if(!c || !s) return alert("Please select a star rating and write a review!");
            event.target.innerText = "Submitting..."; event.target.disabled = true;
            await fetch(SHEET_URL, { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify({ type: "Review", name: n, content: c, stars: s.value, prod: document.getElementById('rev-p').value, date: new Date().toLocaleDateString() }) });
            location.reload();
        }
        
        displayReviews();
    </script>
</body>
</html>
